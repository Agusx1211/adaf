{
  "id": 44,
  "title": "tests: resolveAskProfile and resolvePMProfile have zero test coverage",
  "description": "## Summary\n\nThe most bug-prone functions in the ask/pm CLI commands have zero test coverage:\n\n- resolveAskProfile() (ask.go:225-291): handles profile lookup, model override, agent flag fallback, command path resolution via config.AgentsConfig. Untested.\n- resolvePMProfile() (pm.go:172-227): same logic, also untested.\n- resolvePMMessage() (pm.go:229-245): untested.\n\nThe existing tests focus on low-value registration checks (TestPMCmdRegistered, TestAskFlagsExist, TestPMCmdFlags) and prompt resolution (which is simple string logic). The profile resolution functions interact with config loading, agent config lookup, and path resolution â€” these are where real bugs hide.\n\nAdditionally, TestUpdateByStateDispatch in state_transitions_test.go is a \"doesn't panic\" smoke test that sends Esc to all 37 states and only checks the result is non-nil. It has some value as a completeness check but tests no actual behavior.\n\n## Suggested fix\n\nAdd tests for resolveAskProfile and resolvePMProfile (or the shared function if issue about CLI dedup is resolved first) covering: profile flag lookup with valid/invalid names, agent flag with model override, missing agent binary, default fallback behavior. These can use a temp config file or mock config.\n\n## Files involved\n\n- internal/cli/ask_test.go\n- internal/cli/pm_test.go\n- internal/tui/state_transitions_test.go",
  "status": "resolved",
  "priority": "medium",
  "labels": [
    "testing",
    "cli"
  ],
  "created": "2026-02-14T10:23:07.134415992Z",
  "updated": "2026-02-14T19:11:56.138539893Z"
}