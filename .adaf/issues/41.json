{
  "id": 41,
  "title": "Unify daemon-client transport: replace raw Unix socket with HTTP/WebSocket",
  "description": "## Summary\n\nUnify the daemon-client transport so that the TUI, web UI, and any future clients all use the same HTTP/WebSocket API. Currently the session daemon uses a raw Unix socket with a hand-rolled newline-delimited JSON protocol (bufio.Scanner on both sides). The planned web UI (p10) needs HTTP/WebSocket. Rather than maintaining two separate transports, replace the raw socket protocol with an HTTP server on the same Unix socket path.\n\n## Motivation\n\n1. Eliminates duplicate transport code (raw socket protocol + HTTP/WS)\n2. Resolves issue #40 (backpressure client drops) — WebSocket libraries provide proper write buffering, ping/pong keepalive, and graceful close frames\n3. The current raw protocol lacks: framing, close reasons, keepalive, reconnection support\n4. The wire format is already JSON — WebSocket text frames are a natural fit\n\n## Design\n\n- Session daemon: replace net.Listener + handleClient with http.Server + WebSocket upgrade on the existing Unix socket path\n- TUI client: replace net.Dial + bufio.Scanner with WebSocket dial over Unix socket\n- adaf web: TCP listener on :8080 with HTTP mux that proxies WebSocket connections to daemon Unix sockets and serves REST API + static frontend\n- Library: nhooyr.io/websocket (context-aware, proper close handshake, fewer deps than gorilla)\n\n## Scope\n\nThis is part of p10-web-foundation. The plan phase description has been updated with full details.",
  "status": "open",
  "priority": "high",
  "labels": [
    "enhancement",
    "daemon",
    "session",
    "web",
    "architecture"
  ],
  "created": "2026-02-14T09:48:44.172293692Z",
  "updated": "2026-02-14T09:48:44.172293692Z"
}