{
  "id": 4,
  "title": "Separate internal agent CLI from user-facing CLI",
  "description": "## Summary\n\nSplit the adaf CLI into two entry points: the current user-facing `adaf` command, and a new lightweight command (working name: `adafctl`, `adafi`, or simply `af`) designed specifically for internal agent-to-system communication.\n\n## Motivation\n\nThe `adaf` CLI currently serves two very different audiences with conflicting needs:\n\n1. **Human users** — want clear help text, rich formatting, confirmations, discoverability, and a broad set of project management commands.\n2. **Internal agents** — need a minimal, predictable, machine-friendly interface. They don't need the full command surface, they need fast execution, and verbose help text is noise that wastes context window tokens.\n\nMixing both audiences in one CLI creates problems:\n- **Help output is noisy for both parties.** Agents see project management commands they'll never use; users see internal orchestration commands that are confusing.\n- **Documentation can't optimize for either audience.** Agent-facing docs should be terse and example-heavy. User-facing docs should be explanatory.\n- **Flags and defaults may conflict.** What's a safe default for a human (e.g., confirmation prompts) is an obstacle for an agent.\n- **Context window waste.** When an agent runs `adaf --help` to discover commands, it ingests a lot of irrelevant text.\n\n## Design\n\n### 1. New Binary\n\nCreate a second binary entry point (e.g., `cmd/af/main.go` or `cmd/adafctl/main.go`) that compiles to a separate executable. It should:\n\n- Share the same internal packages (`store`, `project`, `orchestrator`, etc.)\n- Expose only the commands agents need\n- Default to machine-friendly output (JSON, no color, no interactive prompts)\n- Have minimal, agent-optimized help text\n- Use a short name that's easy for models to type and remember\n\n**Name candidates** (in order of preference):\n- `af` — 2 characters, fast to type, easy for models\n- `adafctl` — follows the `*ctl` convention (kubectl, systemctl)\n- `adafi` — \"adaf internal\"\n\n### 2. Command Surface for the Agent CLI\n\nOnly expose what agents actually need. Likely subset:\n\n```\naf issue create --title \"...\" --description \"...\" --priority high\naf issue list [--status open]\naf issue update \u003cid\u003e --status resolved\naf issue show \u003cid\u003e\naf plan show [--id \u003cplan\u003e]\naf decision create --title \"...\" --rationale \"...\"\naf doc show \u003cname\u003e\naf status                  # project status summary\naf rank \u003cturn-id\u003e --score 4 --category bugfix   # (ties into issue #3)\n```\n\nEverything else (session management, TUI, agent detection, config) stays in `adaf` only.\n\n### 3. Output Format\n\nThe agent CLI should:\n- Default to `--format json` (structured, parseable)\n- Suppress color codes and spinners\n- Never prompt for confirmation\n- Return meaningful exit codes\n- Keep stderr for errors only\n\n### 4. Discoverability for Agents\n\nInclude the agent CLI path and a brief usage summary in the system prompt generated by `pkg/protocol/`. This way spawned agents know the command exists and what it can do without running `--help`.\n\n### 5. Build \u0026 Install\n\n- `make build` produces both `bin/adaf` and `bin/af`\n- `make install` installs both\n- Same version injection via ldflags\n- The agent binary should be as small as possible (don't link TUI dependencies like Bubble Tea)\n\n### 6. Environment\n\nThe agent CLI should auto-detect its context from environment variables already set by the orchestrator (`ADAF_TURN_ID`, `ADAF_PROJECT_DIR`, etc.), minimizing the flags agents need to pass.\n\n## Open Questions\n\n- What's the right name? `af` is shortest but might conflict with existing tools on some systems.\n- Should we gate access? (e.g., the agent CLI only works when `ADAF_TURN_ID` is set, preventing accidental human use)\n- Should the agent CLI be a symlink/alias that triggers a different mode in the same binary (like `busybox`), or a genuinely separate binary?\n- Are there commands the agent needs that the user CLI doesn't currently have?\n\n## Implementation Notes\n\n- The bulk of the work is reorganizing `internal/cli/` to separate shared command definitions from audience-specific wiring\n- Consider a shared `internal/cli/commands/` package that both entry points import, with each entry point selecting which commands to register\n- The Cobra command tree can be built differently in each main.go\n- This pairs well with issue #3 (ranking system) — the `af rank` command would live only in the agent CLI",
  "status": "resolved",
  "priority": "medium",
  "labels": [
    "feature",
    "cli",
    "agents",
    "dx"
  ],
  "created": "2026-02-12T19:35:41.780417303Z",
  "updated": "2026-02-13T03:25:51.768800581Z"
}